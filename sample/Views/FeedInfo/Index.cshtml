@model List<PoultryProject.BL.Models.feedinfo>
@using System.Text.Json

@{
    Layout = "_Layout";
}
<div class="container mt-4">
    <h2 class="text-primary">🐔 Feed Information Records</h2>
    <div class="card shadow-sm">
        <div class="card-body">
            <div class="table-responsive table-scroll">
                <table class="table table-bordered table-striped mb-0">
                    <thead class="table-dark">
                        <tr>
                            <th>Batch Name</th>
                            <th>Sacks Used</th>
                            <th>Supplier Name</th>
                            <th>Remaining</th>
                            <th>Total</th>

                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var record in Model)
                        {
                            <tr>
                                <td>@record.name</td>
                                <td>@record.sacksUsed</td>
                                <td>@record.suppliername</td>
                                <td>@record.remaining</td>
                                <td>@record.totalsacks</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
	</div>
</div>
<div class="row">
    <div class="col-lg-6">
        <div class="card" style="margin-left: 3rem;">
            <div class="card-header">
                <h3 class="card-title">Feed Usage Efficiency (%)</h3>
            </div>
            <div class="card-body">
                <canvas id="doughnutChart" style="min-height:250px; height:250px; max-height:250px; width:100%;"></canvas>
            </div>
        </div>
    </div>


    <div class="col-lg-6">
        <div class="card" style="padding-right:3rem;margin-right:3rem">
            <div class="card-header">
                <h3 class="card-title">Feed Usage by Batch</h3>
            </div>
            <div class="card-body">
                <canvas id="barChart" style="min-height:250px; height:250px; max-height:300px; width:100%;"></canvas>
            </div>
        </div>
    </div>
    </div>
@section scripts{
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <script>
                 const percentLabels = @Html.Raw(JsonSerializer.Serialize(ViewBag.PercentLabels ?? new List<string>()));
        const percentData = @Html.Raw(JsonSerializer.Serialize(ViewBag.PercentData ?? new List<double>()));

                        const barLabels = @Html.Raw(JsonSerializer.Serialize(ViewBag.BarLabels ?? new List<string>()));
        const usedData = @Html.Raw(JsonSerializer.Serialize(ViewBag.UsedData ?? new List<int>()));
        const remainingData = @Html.Raw(JsonSerializer.Serialize(ViewBag.RemainingData ?? new List<int>()));

                // const pieLabels = @Html.Raw(JsonSerializer.Serialize(ViewBag.PieLabels ?? new List<string>()));
                // const pieData = @Html.Raw(JsonSerializer.Serialize(ViewBag.PieValues ?? new List<int>()));

                      const doughnutCtx = document.getElementById('doughnutChart').getContext('2d');
        new Chart(doughnutCtx, {
            type: 'doughnut',
            data: {
                labels: percentLabels,
                datasets: [{
                    label: 'Feed Used (%)',
                    data: percentData,
                    backgroundColor: [
                        '#007bff', '#28a745', '#ffc107', '#dc3545',
                        '#17a2b8', '#6f42c1', '#fd7e14', '#20c997'
                    ],
                    hoverOffset: 10
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.label + ': ' + context.parsed + '%';
                            }
                        }
                    },
                  legend: {
            position: 'right',
            labels: {
        color: '#4682B4', // ✅ Best neutral for both dark and bluish themes
                font: {
                    size: 14
                },
                boxWidth: 60
            }
        }


                }
            }
        });

                                  const barCtx = document.getElementById('barChart').getContext('2d');
        new Chart(barCtx, {
            type: 'bar',
            data: {
                labels: barLabels,
                datasets: [
                    {
                        label: 'Sacks Used',
                        data: usedData,
                        backgroundColor: 'rgba(255,99,132,0.7)'
                    },
                    {
                        label: 'Remaining',
                        data: remainingData,
                        backgroundColor: 'rgba(54,162,235,0.7)'
                    }
                ]
            },
            options: {
                indexAxis: 'y', // makes it horizontal
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        beginAtZero: true,
                        ticks: {
                            color: '#4682B4' 
                        }
                    },
                    y: {
                        ticks: {
                            color: '#4682B4' 
                        }
                    }
                },
                plugins: {
                    legend: {
                        labels: {
                            color: '#4682B4'
                        }
                    }
                }
            }
        });

             </script>
    }
